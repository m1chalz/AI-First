# Implementation Plan: Animal List Screen

**Branch**: `005-animal-list` | **Date**: 2025-11-19 | **Spec**: [spec.md](./spec.md)  
**Input**: Feature specification from `/specs/005-animal-list/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command based on the feature specification and project constitution.

## Summary

The Animal List Screen serves as the primary entry point for the PetSpot application across all platforms (Android, iOS, Web). It displays a scrollable list of animals (8-12 mock items) with the ability to navigate to detail screens and report missing animals. This is a UI-only implementation with mocked business logic to establish the foundational screen structure before backend integration.

**Technical Approach**: Each platform implements its own native UI following mandated patterns - Android uses Compose with MVI architecture, iOS uses SwiftUI with MVVM-C coordinators, and Web uses React with TypeScript hooks. The shared module provides Animal domain model and GetAnimals use case with mock implementations. All interactions (card taps, button actions) are mocked and will trigger placeholder navigation.

## Technical Context

**Language/Version**: Kotlin 1.9+ (Android/Shared), Swift 5.9+ (iOS), TypeScript 5.x (Web), Node.js v24 (Backend - not affected by this feature)  
**Primary Dependencies**: 
- Android: Jetpack Compose, Kotlin Coroutines + Flow, Koin
- iOS: SwiftUI, Swift Concurrency (async/await), Koin (from KMP)
- Web: React 18+, TypeScript, Vite
- Shared: Kotlin Multiplatform, Koin Core

**Storage**: Mock data (in-memory lists) - backend integration deferred  
**Testing**: 
- Shared: Kotlin Test + Koin Test
- Android: JUnit 5 + Turbine (Flow testing) + Koin Test
- iOS: XCTest with Swift Concurrency
- Web: Vitest + React Testing Library
- E2E: Playwright (web), Appium (mobile)

**Target Platform**: Android 8+ (API 26+), iOS 15+, Web (modern browsers ES2015+)  
**Project Type**: Kotlin Multiplatform Mobile + Web (thin shared layer)  
**Performance Goals**: 60 FPS scrolling (per spec clarification: performance targets removed but still best practice)  
**Constraints**: 
- UI-only (no backend calls)
- Mock data: 8-12 animals with varied species, breeds, names, and statuses
- Empty state: "No animals reported yet. Tap 'Report a Missing Animal' to add the first one."
- Primary button: "Report a Missing Animal" (fixed at bottom on mobile)
- Reserved space for future search component at top

**Scale/Scope**: Single screen feature, 3 user stories (P1: View List, P2: Report Action, P3: Search Preparation), ~10 animal entities in mock data

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### KMP Architecture Compliance

- [x] **Thin Shared Layer**: Feature design keeps `/shared` limited to domain models, repository interfaces, and use cases
  - Animal domain model in `/shared/src/commonMain/.../domain/models/`
  - AnimalRepository interface in `/shared/src/commonMain/.../domain/repositories/`
  - GetAnimalsUseCase in `/shared/src/commonMain/.../domain/usecases/`
  - No UI components, ViewModels, or platform-specific code in `commonMain`
  - ✅ COMPLIANT: Shared layer contains only domain logic

- [x] **Native Presentation**: Each platform implements its own presentation layer
  - Android: AnimalListViewModel (MVI) in `/composeApp/src/androidMain/.../features/animallist/presentation/viewmodels/`
  - Android: Composable screens in `/composeApp/src/androidMain/.../features/animallist/ui/`
  - iOS: AnimalListViewModel (ObservableObject) in `/iosApp/iosApp/ViewModels/AnimalListViewModel.swift`
  - iOS: SwiftUI views in `/iosApp/iosApp/Views/AnimalListView.swift`
  - iOS: AnimalListCoordinator (UIKit) in `/iosApp/iosApp/Coordinators/AnimalListCoordinator.swift`
  - Web: React components in `/webApp/src/components/AnimalList.tsx`
  - Web: Custom hook `useAnimalList` in `/webApp/src/hooks/useAnimalList.ts`
  - ✅ COMPLIANT: Each platform has its own presentation implementation

- [x] **Android MVI Architecture**: Android features follow the mandated Compose MVI loop
  - `AnimalListUiState` data class (immutable) with pets, isLoading, error properties
  - `AnimalListIntent` sealed interface (Refresh, SelectAnimal, ReportMissing, ReportFound)
  - `AnimalListEffect` sealed interface (NavigateToDetails, NavigateToReportMissing, NavigateToReportFound)
  - `AnimalListReducer` object with pure reduce function
  - `AnimalListViewModel` exposes `StateFlow<UiState>`, `SharedFlow<UiEffect>`, and `dispatchIntent()`
  - Composable collects state via `collectAsStateWithLifecycle()` and emits intents via callbacks
  - ✅ COMPLIANT: Full MVI loop implemented

- [x] **iOS MVVM-C Architecture**: iOS features follow the mandated SwiftUI + MVVM-C pattern
  - `AnimalListViewModel` as `ObservableObject` with `@Published` properties (pets, isLoading, error)
  - `AnimalListCoordinator` (UIKit-based) creates `UIHostingController` for SwiftUI view
  - ViewModel communicates with coordinator via closures (`onAnimalSelected`, `onReportMissing`, `onReportFound`)
  - SwiftUI view observes ViewModel and triggers methods (no direct navigation)
  - Coordinator manages navigation flow and creates child coordinators
  - ✅ COMPLIANT: MVVM-C pattern implemented

- [x] **Interface-Based Design**: Domain logic uses interfaces for repositories
  - `AnimalRepository` interface in `/shared/src/commonMain/.../domain/repositories/AnimalRepository.kt`
  - Mock implementation `MockAnimalRepository` in platform modules (Android, iOS, Web)
  - `GetAnimalsUseCase` references interface, not concrete implementation
  - ✅ COMPLIANT: Repository pattern with interfaces

- [x] **Dependency Injection**: Plan includes Koin setup for all platforms
  - Shared domain module in `/shared/src/commonMain/.../di/DomainModule.kt` (GetAnimalsUseCase)
  - Android data module in `/composeApp/src/androidMain/.../di/DataModule.kt` (MockAnimalRepository)
  - Android ViewModel module in `/composeApp/src/androidMain/.../di/ViewModelModule.kt` (AnimalListViewModel)
  - iOS Koin initialization in `/iosApp/iosApp/DI/KoinInitializer.swift`
  - Web DI setup (if using Koin/JS) in `/webApp/src/di/setup.ts` or native hooks
  - ✅ COMPLIANT: Koin DI configured for all platforms

- [x] **80% Test Coverage - Shared Module**: Plan includes unit tests for shared domain logic
  - Tests in `/shared/src/commonTest/kotlin/.../domain/usecases/GetAnimalsUseCaseTest.kt`
  - Tests verify GetAnimalsUseCase returns mock data successfully
  - Coverage target: 80% line + branch coverage
  - Run command: `./gradlew :shared:test koverHtmlReport`
  - Tests use Koin Test for DI with FakeAnimalRepository
  - ✅ COMPLIANT: Unit tests planned with Koin Test

- [x] **80% Test Coverage - ViewModels**: Plan includes unit tests for ViewModels on each platform
  - Android: Tests in `/composeApp/src/androidUnitTest/.../features/animallist/presentation/viewmodels/AnimalListViewModelTest.kt`
    - Test MVI reducers, intent handling, state transitions with Turbine
    - Run `./gradlew :composeApp:testDebugUnitTest koverHtmlReport`
  - iOS: Tests in `/iosApp/iosAppTests/ViewModels/AnimalListViewModelTests.swift`
    - Test `@Published` property updates, coordinator callback invocations
    - Run via XCTest with coverage enabled
  - Web: Tests in `/webApp/src/__tests__/hooks/useAnimalList.test.ts`
    - Test hook state updates, loading states, error handling
    - Run `npm test -- --coverage`
  - Coverage target: 80% per platform
  - ✅ COMPLIANT: ViewModel tests planned for all platforms

- [x] **End-to-End Tests**: Plan includes E2E tests for all user stories
  - Web: Playwright test in `/e2e-tests/web/specs/animal-list.spec.ts`
  - Mobile: Appium test in `/e2e-tests/mobile/specs/animal-list.spec.ts`
  - Page Object Model: `/e2e-tests/web/pages/AnimalListPage.ts`
  - Screen Object Model: `/e2e-tests/mobile/screens/AnimalListScreen.ts`
  - Step definitions in `/e2e-tests/*/steps/animalListSteps.ts`
  - Tests cover all 3 user stories: View List, Report Action, Navigate to Details
  - ✅ COMPLIANT: E2E tests planned with POM/SOM patterns

- [x] **Platform Independence**: Shared code uses expect/actual for platform dependencies
  - No platform-specific imports in `commonMain` for this feature (domain models only)
  - Repository implementations provided via Koin DI, not expect/actual
  - Mock data generation can be platform-agnostic (Kotlin common code)
  - ✅ COMPLIANT: No platform dependencies in shared for this feature

- [x] **Clear Contracts**: Repository interfaces and use cases have explicit APIs
  - `suspend fun getAnimals(): Result<List<Animal>>` - returns Result<T>
  - KDoc documentation on AnimalRepository interface and GetAnimalsUseCase
  - Animal model exported for web via `@OptIn(ExperimentalJsExport::class)` and `@JsExport`
  - ✅ COMPLIANT: Typed APIs with documentation

- [x] **Asynchronous Programming Standards**: Plan uses correct async patterns per platform
  - Shared: Kotlin Coroutines with `suspend fun getAnimals()`
  - Android: Kotlin Coroutines in ViewModel (`viewModelScope.launch`), Flow for state
  - iOS: Swift Concurrency (`async func loadAnimals()`) with `@MainActor` for UI updates
  - Web: Native `async`/`await` in hooks and services
  - No Combine, RxJava, RxSwift, or Promise chains
  - ✅ COMPLIANT: Modern async patterns enforced

- [x] **Test Identifiers for UI Controls**: Plan includes test identifiers for all interactive elements
  - Android testTags:
    - `animalList.list` (LazyColumn)
    - `animalList.item.${animal.id}` (each card)
    - `animalList.reportMissingButton.click` (primary button)
    - `animalList.reportFoundButton.click` (secondary button on mobile)
    - `animalList.searchPlaceholder` (reserved search area)
  - iOS accessibilityIdentifiers: same naming convention
  - Web data-testid: same naming convention
  - ✅ COMPLIANT: Test identifiers planned for all interactive elements

- [x] **Public API Documentation**: Plan ensures all public APIs have documentation
  - Kotlin: KDoc on Animal model, AnimalRepository interface, GetAnimalsUseCase
  - Swift: SwiftDoc on AnimalListViewModel methods and properties
  - TypeScript: JSDoc on useAnimalList hook and AnimalList component
  - Documentation style: concise, high-level (1-3 sentences: WHAT/WHY, not HOW)
  - Example: `/** Retrieves list of animals from repository. Returns mock data until backend integration. */`
  - ✅ COMPLIANT: Documentation planned for all public APIs

- [x] **Given-When-Then Test Structure**: Plan ensures all tests follow Given-When-Then convention
  - Kotlin tests: Backtick names like `` `should return mock animals when repository succeeds` ``
  - Swift tests: CamelCase with underscores like `testLoadAnimals_whenRepositorySucceeds_shouldUpdatePets`
  - TypeScript tests: Descriptive strings like `'should display animals when data loads successfully'`
  - All tests structured with Given (setup), When (action), Then (verification) phases
  - Comments marking phases in complex tests
  - ✅ COMPLIANT: GWT convention planned for all tests

### Backend Architecture & Quality Standards (if `/server` affected)

- [x] **Backend Not Affected**: This feature is UI-only with mocked data sources
  - No REST API endpoints required for this iteration
  - No database changes required
  - Backend integration will be added in future sprint
  - ✅ N/A: Backend module not affected by this feature

## Project Structure

### Documentation (this feature)

```text
specs/005-animal-list/
├── spec.md              # Feature specification (completed)
├── plan.md              # This file (current: implementation plan)
├── research.md          # Phase 0 output (design decisions, patterns)
├── data-model.md        # Phase 1 output (Animal entity structure)
├── contracts/           # Phase 1 output (mock repository contracts)
│   └── AnimalRepository.kt.md  # Repository interface definition
├── quickstart.md        # Phase 1 output (setup instructions)
├── checklists/          # Quality validation
│   └── requirements.md  # Spec validation checklist (completed)
└── design/              # Figma design reference
    └── README.md        # Design system documentation
```

### Source Code (repository root)

```text
# Kotlin Multiplatform Shared Module
shared/src/
├── commonMain/kotlin/com/intive/aifirst/petspot/
│   ├── domain/
│   │   ├── models/
│   │   │   ├── Animal.kt              # NEW: Animal data class with @JsExport
│   │   │   ├── AnimalStatus.kt        # NEW: Enum (Active, Found, Closed)
│   │   │   ├── AnimalSpecies.kt       # NEW: Enum (Dog, Cat, etc.)
│   │   │   └── Location.kt            # NEW: Data class (city, radius)
│   │   ├── repositories/
│   │   │   └── AnimalRepository.kt    # NEW: Repository interface
│   │   └── usecases/
│   │       └── GetAnimalsUseCase.kt   # NEW: Use case for fetching animals
│   └── di/
│       └── DomainModule.kt            # UPDATED: Add GetAnimalsUseCase to Koin
└── commonTest/kotlin/com/intive/aifirst/petspot/
    └── domain/usecases/
        └── GetAnimalsUseCaseTest.kt   # NEW: Unit tests with FakeAnimalRepository

# Android App (Jetpack Compose + MVI)
composeApp/src/
├── androidMain/kotlin/com/intive/aifirst/petspot/
│   ├── features/animallist/
│   │   ├── ui/
│   │   │   ├── AnimalListScreen.kt    # NEW: Main composable screen
│   │   │   ├── AnimalCard.kt          # NEW: Composable for animal item
│   │   │   └── EmptyState.kt          # NEW: Composable for empty list
│   │   ├── presentation/
│   │   │   ├── mvi/
│   │   │   │   ├── AnimalListUiState.kt      # NEW: Immutable UI state
│   │   │   │   ├── AnimalListIntent.kt       # NEW: Sealed user intents
│   │   │   │   ├── AnimalListEffect.kt       # NEW: Sealed one-off effects
│   │   │   │   └── AnimalListReducer.kt      # NEW: Pure reducer function
│   │   │   └── viewmodels/
│   │   │       └── AnimalListViewModel.kt    # NEW: MVI ViewModel
│   │   └── navigation/
│   │       └── AnimalListNavigation.kt       # NEW: Navigation setup
│   ├── data/
│   │   └── MockAnimalRepository.kt    # NEW: Mock repository implementation
│   └── di/
│       ├── DataModule.kt              # UPDATED: Add MockAnimalRepository
│       └── ViewModelModule.kt         # UPDATED: Add AnimalListViewModel
└── androidUnitTest/kotlin/com/intive/aifirst/petspot/
    └── features/animallist/
        └── presentation/
            ├── mvi/
            │   └── AnimalListReducerTest.kt  # NEW: Reducer unit tests
            └── viewmodels/
                └── AnimalListViewModelTest.kt # NEW: ViewModel tests with Turbine

# iOS App (SwiftUI + MVVM-C)
iosApp/iosApp/
├── Coordinators/
│   ├── AppCoordinator.swift                   # UPDATED: Set AnimalList as root
│   └── AnimalListCoordinator.swift            # NEW: Coordinator for animal list flow
├── ViewModels/
│   └── AnimalListViewModel.swift              # NEW: ObservableObject with @Published
├── Views/
│   ├── AnimalListView.swift                   # NEW: SwiftUI main view
│   ├── AnimalCardView.swift                   # NEW: SwiftUI card component
│   └── EmptyStateView.swift                   # NEW: SwiftUI empty state
├── Repositories/
│   └── MockAnimalRepository.swift             # NEW: Mock repository for iOS
└── DI/
    └── KoinInitializer.swift                  # UPDATED: Register iOS-specific modules

iosApp/iosAppTests/
└── ViewModels/
    └── AnimalListViewModelTests.swift         # NEW: ViewModel unit tests with XCTest

# Web App (React + TypeScript)
webApp/src/
├── components/
│   ├── AnimalList/
│   │   ├── AnimalList.tsx                     # NEW: Main list component
│   │   ├── AnimalCard.tsx                     # NEW: Card component
│   │   ├── EmptyState.tsx                     # NEW: Empty state component
│   │   └── AnimalList.module.css              # NEW: Styles (or styled-components)
├── hooks/
│   └── useAnimalList.ts                       # NEW: Custom hook for state management
├── services/
│   └── mockAnimalRepository.ts                # NEW: Mock repository service
└── __tests__/
    ├── components/
    │   └── AnimalList.test.tsx                # NEW: Component tests
    └── hooks/
        └── useAnimalList.test.ts              # NEW: Hook unit tests

# End-to-End Tests
e2e-tests/
├── web/
│   ├── specs/
│   │   └── animal-list.spec.ts                # NEW: Playwright E2E tests
│   ├── pages/
│   │   └── AnimalListPage.ts                  # NEW: Page Object Model
│   ├── steps/
│   │   └── animalListSteps.ts                 # NEW: Reusable test steps
│   └── fixtures/
│       └── mockAnimals.ts                     # NEW: Test data fixtures
└── mobile/
    ├── specs/
    │   └── animal-list.spec.ts                # NEW: Appium E2E tests
    ├── screens/
    │   └── AnimalListScreen.ts                # NEW: Screen Object Model
    ├── steps/
    │   └── animalListSteps.ts                 # NEW: Reusable test steps
    └── utils/
        └── mockDataHelper.ts                  # NEW: Test utilities
```

**Structure Decision**: This is a Kotlin Multiplatform project with thin shared layer (domain models, repository interfaces, use cases only) and native presentation on each platform. The Animal List Screen introduces the first full-featured screen with MVI on Android, MVVM-C on iOS, and React hooks on Web. All three platforms consume the shared GetAnimalsUseCase through their respective mock repository implementations injected via Koin.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

No violations - all constitution requirements are met:
- Shared layer remains thin (domain only)
- Native presentation on each platform (Compose MVI, SwiftUI MVVM-C, React hooks)
- 80% test coverage planned for shared, ViewModels, and E2E
- Test identifiers, documentation, and GWT structure enforced
- Backend not affected (UI-only feature with mocks)

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A       | N/A        | N/A                                 |
