# Implementation Plan: Home Lost Pets Teaser

**Branch**: `059-home-lost-pets` | **Date**: 2025-12-16 | **Spec**: [spec.md](../spec.md)
**Input**: Feature specification from `/specs/059-home-lost-pets/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command following Phase 0 research and Phase 1 design. Ready for Phase 2 task breakdown.

## Summary

Implement a lost pets teaser component on the Android home page that displays up to 5 recently reported lost pets, following MVI architecture patterns and reusing existing navigation and backend integration.

## Technical Context

**Language/Version**: Kotlin 2.2.20 (Android target)
**Primary Dependencies**: Jetpack Compose, Koin (DI), Kotlin Coroutines + Flow, Ktor (HTTP client), Jetpack Navigation Component  
**Storage**: N/A (data fetched from backend API)  
**Testing**: JUnit 6 + Kotlin Test + Turbine (Flow testing)  
**Target Platform**: Android API 26+ (Android 8.0+) with target SDK 36  
**Project Type**: Mobile (Android only)  
**Performance Goals**: N/A (Performance is not a concern for this project - see Principle XIV)  
**Constraints**: Must follow MVI architecture, reuse existing navigation patterns, integrate with existing lost pets list  
**Scale/Scope**: Small feature (1 new component), low complexity, expected ~5-10 files

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

> **Note**: For backend-only features (affecting only `/server` module), you may mark frontend-related checks (Platform Independence, Android MVI, iOS MVVM-C, Test Identifiers for UI, E2E Tests for mobile/web) as N/A. Focus on Backend Architecture & Quality Standards checks.

### Platform Architecture Compliance

- [x] **Platform Independence**: Each platform implements full stack independently
  - Android: Domain models, use cases, repositories, ViewModels in `/composeApp`
  - iOS: Domain models, use cases, repositories, ViewModels in `/iosApp`
  - Web: Domain models, services, state management in `/webApp`
  - Backend: Independent Node.js/Express API in `/server`
  - NO shared compiled code between platforms
  - Violation justification: _Android-only feature - justified as this component is specific to Android home page_

- [x] **Android MVI Architecture**: Android features follow the mandated Compose MVI loop
  - Single `StateFlow<UiState>` source of truth with immutable data classes
  - Sealed `UserIntent` and optional `UiEffect` types co-located with feature packages
  - Reducers implemented as pure functions (no side effects) and unit-tested
  - `dispatchIntent` entry wired from UI → ViewModel → reducer, with effects delivered via `SharedFlow`
  - Navigation MUST use Jetpack Navigation Component (androidx.navigation:navigation-compose)
  - Navigation graph defined with `NavHost` composable
  - ViewModels trigger navigation via `UiEffect`, not direct `NavController` calls
  - Composable screens follow two-layer pattern: state host (stateful) + stateless content composable
  - Stateless composables MUST have `@Preview` with `@PreviewParameter` using custom `PreviewParameterProvider<UiState>`
  - Callback lambdas MUST be defaulted to no-ops in stateless composables
  - Previews focus on light mode only (no dark mode previews required)

- [ ] **iOS MVVM-C Architecture**: iOS features follow MVVM-Coordinator pattern
  - N/A - Android-only feature

- [x] **Interface-Based Design**: Domain logic uses interfaces for repositories (per platform)
  - Android: Repository interfaces in `/composeApp/src/androidMain/.../domain/repositories/`
  - Implementations in platform-specific data/repositories modules
  - Use cases reference interfaces, not concrete implementations

- [x] **Dependency Injection**: Plan includes DI setup for each platform
  - Android: MUST use Koin - DI modules in `/composeApp/src/androidMain/.../di/`

- [x] **80% Test Coverage - Platform-Specific**: Plan includes unit tests for each platform
  - Android: Tests in `/composeApp/src/androidUnitTest/`, run `./gradlew :composeApp:testDebugUnitTest koverHtmlReport`
  - Coverage target: 80% line + branch coverage per platform

- [x] **End-to-End Tests**: Plan includes E2E tests for all user stories
  - Mobile: Appium tests in `/e2e-tests/mobile/specs/[feature-name].spec.ts`
  - All tests written in TypeScript
  - Page Object Model / Screen Object Model used
  - Each user story has at least one E2E test

- [x] **Asynchronous Programming Standards**: Plan uses correct async patterns per platform
  - Android: Kotlin Coroutines (`viewModelScope`) + Flow for state
  - No Combine, RxJava, RxSwift, or callback-based patterns for new code

- [x] **Test Identifiers for UI Controls**: Plan includes test identifiers for all interactive elements
  - Android: `testTag` modifier on all interactive composables
  - Naming convention: `{screen}.{element}.{action}` (e.g., `petList.addButton.click`)
  - List items use stable IDs (e.g., `petList.item.${id}`)

- [x] **Public API Documentation**: Plan ensures public APIs have documentation when needed
  - Kotlin: KDoc format (`/** ... */`)
  - Documentation must be concise and high-level (1-3 sentences: WHAT/WHY, not HOW)
  - Document only when purpose is not clear from name alone

- [x] **Given-When-Then Test Structure**: Plan ensures all tests follow Given-When-Then convention
  - Unit tests clearly separate setup (Given), action (When), verification (Then)
  - ViewModel tests use Given-When-Then pattern with descriptive names
  - E2E tests structure scenarios with Given-When-Then phases
  - Test names follow platform conventions (backticks for Kotlin)

### Backend Architecture & Quality Standards (if `/server` affected)

- [ ] **Backend Technology Stack**: Plan uses modern Node.js stack for `/server` module
  - N/A - Android-only feature, no backend changes required

- [ ] **Backend Code Quality**: Plan enforces quality standards for `/server` code
  - N/A - Android-only feature, no backend changes required

- [ ] **Backend Dependency Management**: Plan minimizes dependencies in `/server/package.json`
  - N/A - Android-only feature, no backend changes required

### Web Architecture & Quality Standards (if `/webApp` affected)

- [ ] **Web Technology Stack**: Plan uses modern React 18 + TypeScript stack for `/webApp` module
  - N/A - Android-only feature, no web changes required

- [ ] **Web Code Quality**: Plan enforces quality standards for `/webApp` code
  - N/A - Android-only feature, no web changes required

- [ ] **Web Dependency Management**: Plan minimizes dependencies in `/webApp/package.json`
  - N/A - Android-only feature, no web changes required

- [ ] **Web Business Logic Extraction**: Plan ensures business logic is extracted to testable functions
  - N/A - Android-only feature, no web changes required

- [ ] **Web TDD Workflow**: Plan follows Test-Driven Development (Red-Green-Refactor)
  - N/A - Android-only feature, no web changes required

- [ ] **Web Testing Strategy**: Plan includes comprehensive test coverage for `/webApp`
  - N/A - Android-only feature, no web changes required

- [ ] **Backend Directory Structure**: Plan follows standardized layout in `/server/src/`
  - N/A - Android-only feature, no backend changes required

- [ ] **Backend TDD Workflow**: Plan follows Test-Driven Development (Red-Green-Refactor)
  - N/A - Android-only feature, no backend changes required

- [ ] **Backend Testing Strategy**: Plan includes comprehensive test coverage for `/server`
  - N/A - Android-only feature, no backend changes required

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
composeApp/src/androidMain/kotlin/com/intive/aifirst/petspot/
├── features/home/
│   └── ui/
│       └── HomeScreen.kt             # Main home screen composable
├── features/lostPetsTeaser/
│   ├── presentation/
│   │   ├── mvi/
│   │   │   ├── LostPetsTeaserUiState.kt      # Teaser UiState data classes
│   │   │   ├── LostPetsTeaserIntent.kt       # Teaser sealed intent classes
│   │   │   └── LostPetsTeaserEffect.kt       # Teaser UiEffect classes
│   │   └── viewmodels/
│   │       └── LostPetsTeaserViewModel.kt    # MVI ViewModel for teaser component
│   └── ui/
│       └── LostPetsTeaser.kt         # Teaser component composable
├── domain/
│   ├── models/
│   │   └── LostPet.kt                # Domain model for lost pet (existing)
│   ├── repositories/
│   │   └── LostPetsRepository.kt     # Repository interface (extended)
│   └── usecases/
│       └── GetRecentLostPetsUseCase.kt # Use case for fetching pets
├── data/repositories/
│   └── LostPetsRepositoryImpl.kt     # Repository implementation (extended)
└── di/
    └── HomeModule.kt                 # Koin DI module

composeApp/src/androidUnitTest/kotlin/com/intive/aifirst/petspot/
├── features/home/ui/
│   └── HomeScreenTest.kt              # Home screen UI tests (if needed)
├── features/lostPetsTeaser/presentation/viewmodels/
│   ├── LostPetsTeaserViewModelTest.kt # Teaser ViewModel unit tests
│   └── LostPetsTeaserReducerTest.kt   # Teaser reducer unit tests
├── domain/usecases/
│   └── GetRecentLostPetsUseCaseTest.kt # Use case unit tests
└── data/repositories/
    └── LostPetsRepositoryImplTest.kt  # Repository unit tests

e2e-tests/java/src/test/java/com/intive/petspot/android/
├── pages/
│   └── HomePage.java                 # Page Object Model for home screen
├── screens/
│   └── LostPetsTeaserScreen.java     # Screen Object Model for teaser
└── specs/
    └── HomeLostPetsTeaserSpec.java   # E2E test scenarios
```

**Structure Decision**: Android-only implementation with separated feature architecture. Home screen feature (`features/home/`) contains only home-specific UI components. Lost pets teaser is implemented as its own reusable feature (`features/lostPetsTeaser/`) with complete MVI architecture, enabling potential reuse in other screens. Both features follow established project patterns with `presentation/` for MVI classes and `ui/` for composables.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
